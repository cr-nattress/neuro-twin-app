# .claude/skills/ai_friendly_comments.skill.yaml
# Drop this file into your repo under `.claude/skills/`.
# Run with Claude Code → Skills → "AI‑Friendly Code Comment Updater".
# The skill scans a JS/TS codebase and adds/updates structured, agent‑friendly comments
# without changing runtime behavior.

name: AI‑Friendly Code Comment Updater
version: 1.0.0
about: |
  Refactors documentation ONLY. Adds/updates JSDoc/TSDoc and inline intent comments so coding agents
  (Claude Code, Cursor, Windsurf) can reason about purpose, decisions, side effects, and APIs.
  Does not change logic, signatures, or public behavior.

inputs:
  include_examples:
    type: boolean
    default: true
    help: Include @example blocks for public functions and classes.
  add_ai_metadata_blocks:
    type: boolean
    default: true
    help: Insert short YAML ai-metadata blocks for validators, mappers, adapters, etc.
  enforce_tsdoc:
    type: boolean
    default: true
    help: Normalize JSDoc → TSDoc tags in TS projects.
  adr_inline_notes:
    type: boolean
    default: true
    help: Add compact ADR-style decision notes near tradeoffs.
  max_file_size_kb:
    type: integer
    default: 600
    help: Skip huge bundles/lockfiles; comment only human-authored source.
  languages:
    type: string
    default: "ts,tsx,js,jsx,mts,cts"
    help: Comma-separated list of file extensions to include.
  exclude_globs:
    type: string
    default: "**/node_modules/**,**/dist/**,**/build/**,**/.next/**,**/coverage/**,**/*.min.*"
  comment_density_target:
    type: string
    default: "balanced"
    help: one of: minimal|balanced|max-intent (balanced is recommended)
  side_effects_documentation:
    type: boolean
    default: true
    help: Add @sideeffects and persistence notes (localStorage, network, fs, env).
  create_branch:
    type: boolean
    default: true
  branch_name:
    type: string
    default: "chore/ai-friendly-comments"
  open_pull_request:
    type: boolean
    default: false
  pr_title:
    type: string
    default: "docs: add AI‑friendly code comments (JSDoc/TSDoc, intent, decisions)"
  pr_body:
    type: string
    default: |
      This PR improves AI-agent readability without code behavior changes.
      - Adds/updates JSDoc/TSDoc for modules, classes, and functions
      - Documents purpose, decisions, assumptions, and side effects
      - Inserts examples and small ADR notes where helpful
      - No logic changes; type-only commentary

rules:
  - Do NOT change runtime logic, control flow, or data contracts.
  - Do NOT rename public APIs, exports, or files.
  - Do NOT introduce new dependencies.
  - Preserve code formatting; run formatter at end (prettier/eslint if present).
  - Keep comments truthful; infer carefully and mark uncertainty with TODO.
  - Prefer short, high-signal prose over verbose narration.

style_guide:
  hierarchy: |
    Preferred documentation hierarchy per file:
      1) File header (module) block: purpose, context, dependencies, exports
      2) Class/interface blocks: summary, pattern, assumptions, side effects
      3) Function/method blocks: params, returns, throws, example, decision
      4) Sparse inline comments for non-obvious intent and edge cases
  tags:
    - "@module"      # file header summary of purpose & exports
    - "@purpose"     # why this exists
    - "@context"     # where/when it's used
    - "@dependencies"# notable libs/services
    - "@class"       # class summaries
    - "@pattern"     # e.g., Singleton, Adapter, Observer
    - "@assumes"     # preconditions the code relies on
    - "@sideeffects" # IO: fs, network, storage, env, timers
    - "@decision"    # key tradeoff choice
    - "@example"     # typical usage snippet
  inline_comments: |
    Use inline comments for intent, invariants, race-condition guards, and complexity hotspots.
    Avoid restating the code. Prefer: "Guard against double refresh" over "check flag".

checks:
  - name: Types compile
    run: npx -y tsc -v && npx -y tsc --noEmit || true
  - name: ESLint
    run: npx -y eslint . --ext .ts,.tsx,.js,.jsx || true
  - name: Prettier
    run: npx -y prettier -c . || true

plan: |
  1) Detect TS/JS project layout and tooling (tsconfig, eslint, prettier, jest/vitest).
  2) Build a symbol map of modules, exports, classes, public functions, and top-level utilities.
  3) For each file within languages & outside exclude_globs:
       - Insert or update a top-of-file @module block describing purpose, context, dependencies, and exports.
       - For each class/interface/type with external usage, add/refresh a block with @summary, @pattern, @assumes, @sideeffects.
       - For each exported function/method, add/refresh docblock with params, returns, throws, @decision, optional @example.
       - Add minimal inline intent comments only where the reasoning isn't obvious (concurrency, caching, indexing, retries).
       - Optionally add ai-metadata YAML block for validators/mappers/adapters when add_ai_metadata_blocks=true.
       - Insert brief ADR inline notes where adr_inline_notes=true and a conscious tradeoff is detected.
  4) Normalize tags to TSDoc when enforce_tsdoc=true (e.g., @returns → @returns, @throws retained, add @remarks as needed).
  5) Maintain comment_density_target: "balanced" ≈ 1–3 meaningful blocks per 100 LOC, inline comments only for intent.
  6) Run checks (tsc/eslint/prettier). If failures are caused by comments, fix formatting or suppress with standard directives.
  7) Produce a changeset summary with per-file stats and examples of added blocks.
  8) If create_branch=true, create a branch; if open_pull_request=true, open a PR with pr_title/pr_body.

execution:
  system: |
    You are Claude Code operating as a repository refactoring assistant focused on documentation.
    Your sole mandate is to add/update comments and docblocks to improve AI-agent comprehension.
    You must NOT alter behavior, logic, or public interfaces.

  user_prompt_template: |
    Update this repository to be AI-agent-friendly per the style_guide and plan.
    Use these parameters:
      include_examples: {{include_examples}}
      add_ai_metadata_blocks: {{add_ai_metadata_blocks}}
      enforce_tsdoc: {{enforce_tsdoc}}
      adr_inline_notes: {{adr_inline_notes}}
      max_file_size_kb: {{max_file_size_kb}}
      languages: {{languages}}
      exclude_globs: {{exclude_globs}}
      comment_density_target: {{comment_density_target}}
      side_effects_documentation: {{side_effects_documentation}}
      create_branch: {{create_branch}}
      branch_name: {{branch_name}}
      open_pull_request: {{open_pull_request}}
      pr_title: {{pr_title}}
      pr_body: |
        {{pr_body}}

    Scope:
      - Source files matching languages, excluding exclude_globs.
      - JS/TS (and React variants) only.

    Deliverables:
      - Updated source files with file/class/function docblocks and essential inline intent comments.
      - A concise CHANGESUMMARY.md at repo root with:
          * Total files touched and LOC commented
          * Examples of before/after for 2–3 key modules
          * A list of any TODOs where intent was uncertain
      - If enabled, a branch and optionally a PR.

success_criteria:
  - All added comments are accurate, high-signal, and succinct.
  - Type-checks and linters still pass (or non-invasive ignores are justified).
  - No public API or runtime behavior changes.
  - File headers give agents a quick mental model of the module.
  - Complex areas (concurrency, caching, retries, indexing) have intent comments.

notes: |
  Tip: Pair with a repo-wide README update explaining comment conventions so future contributors keep docs agent-friendly.
